---
layout: post
title: "Python 多线程vs多进程"
subtitle: "图像缩放任务性能比较"
date: 2025-09-18
author: "Can"
header-img: "img/post-bg-2015.jpg"
tags: ["Python", "GIL"]
---

## 多进程（ProcessPoolExecutor）
1. 每个进程有独立的 Python 解释器和 GIL。
2. 可以真正实现 **CPU 并行**，多个核同时处理图像。
3. 适合 **CPU 密集型任务**（图像处理、科学计算、机器学习训练）。

## 多线程（ThreadPoolExecutor）
1. Python 有 GIL (Global Interpreter Lock，全局解释器锁)：
   - GIL 确保同一时间只有一个线程在执行 Python 字节码。
   - 所以多线程对 **CPU 密集型任务**（比如图像缩放）提升有限。
2. 适合 **I/O 密集型任务**（比如网络请求、文件读写），可以在等待 I/O 操作完成时切换到其他线程，即 **I/O 操作会释放 GIL**。

## 图像缩放任务的选择
* **图像缩放 = CPU 密集型**：主要开销在 Pillow 内部的 C/C++ 代码做像素插值计算。
* 多线程因为 GIL 限制，多个线程大多数时候还是串行执行，可能只有**在读写文件时能并行（I/O释放GIL），速度提升有限**。
* 多进程因为每个进程有独立的 GIL，所以可以真正实现**CPU 并行**，多个核同时处理图像，**速度提升显著**。

## 开销与适用场景
![multi-thread-and-multi-process](/img/in-post/multi-thread-and-multi-process.png)

## 总结
* **线程更适合 I/O 密集型任务**，而**进程更适合 CPU 密集型任务**。